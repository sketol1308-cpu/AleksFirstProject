<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatApp - Public Chat</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="app-logo">
                <div class="logo-icon">ğŸ’¬</div>
                <h1>ChatApp</h1>
                <p class="tagline">Connect and chat in real-time</p>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('login')">Login</button>
                <button class="tab-btn" onclick="switchTab('signup')">Create Account</button>
            </div>

            <div id="loginForm" class="form-section active">
                <h2>Welcome Back!</h2>
                <div id="loginMessage" style="background: #4CAF50; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; font-weight: bold;"></div>
                <form id="loginFormElement">
                    <div class="input-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" placeholder="Enter your username" required>
                    </div>
                    <button type="submit" class="btn-primary" id="loginBtn">Login</button>
                </form>
            </div>

            <div id="signupForm" class="form-section">
                <h2>Create Account</h2>
                <div id="signupMessage" style="background: #4CAF50; color: white; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; font-weight: bold;"></div>
                <form id="signupFormElement">
                    <div class="input-group">
                        <label for="signupUsername">Username</label>
                        <input type="text" id="signupUsername" placeholder="Choose a username" required minlength="3">
                    </div>
                    <div class="input-group">
                        <label for="signupAvatar">Choose Avatar</label>
                        <div class="avatar-selector" id="avatarSelector">
                            <div class="avatar-option selected" data-avatar="ğŸ˜€">ğŸ˜€</div>
                            <div class="avatar-option" data-avatar="ğŸ˜">ğŸ˜</div>
                            <div class="avatar-option" data-avatar="ğŸ¤©">ğŸ¤©</div>
                            <div class="avatar-option" data-avatar="ğŸ¥³">ğŸ¥³</div>
                            <div class="avatar-option" data-avatar="ğŸ˜º">ğŸ˜º</div>
                            <div class="avatar-option" data-avatar="ğŸ¦Š">ğŸ¦Š</div>
                            <div class="avatar-option" data-avatar="ğŸ¼">ğŸ¼</div>
                            <div class="avatar-option" data-avatar="ğŸ¦„">ğŸ¦„</div>
                        </div>
                        <input type="hidden" id="selectedAvatar" value="ğŸ˜€" required>
                    </div>
                    <button type="submit" class="btn-primary" id="signupBtn">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // YOUR REAL Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAM9AVeKv8po7D16h6XM422Eh0heq3hAW0",
            authDomain: "chat-app-with-claude.firebaseapp.com",
            databaseURL: "https://chat-app-with-claude-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chat-app-with-claude",
            storageBucket: "chat-app-with-claude.firebasestorage.app",
            messagingSenderId: "163903134612",
            appId: "1:163903134612:web:8317fa2bc619563d0b8d81"
        };

        let database;

        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log('âœ… Firebase connected successfully!');
        } catch (error) {
            console.error('âŒ Firebase error:', error);
            alert('Error connecting to Firebase: ' + error.message);
        }

        function switchTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const tabs = document.querySelectorAll('.tab-btn');

            tabs.forEach(btn => btn.classList.remove('active'));

            if (tab === 'login') {
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
                tabs[0].classList.add('active');
            } else {
                loginForm.classList.remove('active');
                signupForm.classList.add('active');
                tabs[1].classList.add('active');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Avatar selection
            const avatarOptions = document.querySelectorAll('.avatar-option');
            avatarOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const emoji = this.getAttribute('data-avatar');
                    document.getElementById('selectedAvatar').value = emoji;

                    avatarOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Login form
            const loginFormElement = document.getElementById('loginFormElement');
            const loginBtn = document.getElementById('loginBtn');
            const loginMessage = document.getElementById('loginMessage');

            loginFormElement.addEventListener('submit', function(e) {
                e.preventDefault();

                loginMessage.style.display = 'block';
                loginMessage.textContent = 'âœ“ Checking username...';
                loginBtn.disabled = true;

                const username = document.getElementById('loginUsername').value.trim();

                if (!username) {
                    loginMessage.textContent = 'âš  Please enter a username';
                    loginMessage.style.background = '#ff9800';
                    loginBtn.disabled = false;
                    return;
                }

                database.ref('users').once('value')
                    .then((snapshot) => {
                        const users = snapshot.val() || {};
                        let userFound = null;

                        for (let userId in users) {
                            if (users[userId].username.toLowerCase() === username.toLowerCase()) {
                                userFound = users[userId];
                                break;
                            }
                        }

                        if (userFound) {
                            loginMessage.textContent = 'âœ“ User found! Redirecting...';
                            localStorage.setItem('chatapp_user', JSON.stringify(userFound));
                            setTimeout(() => {
                                window.location.href = 'final-chat.html';
                            }, 500);
                        } else {
                            loginMessage.textContent = 'âŒ Username not found. Please create an account!';
                            loginMessage.style.background = '#f44336';
                            loginBtn.disabled = false;
                        }
                    })
                    .catch(error => {
                        loginMessage.textContent = 'âŒ Error: ' + error.message;
                        loginMessage.style.background = '#f44336';
                        loginBtn.disabled = false;
                    });
            });

            // Signup form
            const signupFormElement = document.getElementById('signupFormElement');
            const signupBtn = document.getElementById('signupBtn');
            const signupMessage = document.getElementById('signupMessage');

            signupFormElement.addEventListener('submit', function(e) {
                e.preventDefault();

                signupMessage.style.display = 'block';
                signupMessage.textContent = 'âœ“ Creating account...';
                signupBtn.disabled = true;

                const username = document.getElementById('signupUsername').value.trim();
                const avatar = document.getElementById('selectedAvatar').value;

                if (!username || username.length < 3) {
                    signupMessage.textContent = 'âš  Username must be at least 3 characters';
                    signupMessage.style.background = '#ff9800';
                    signupBtn.disabled = false;
                    return;
                }

                signupMessage.textContent = 'â³ Checking if username is available...';

                database.ref('users').once('value')
                    .then((snapshot) => {
                        const users = snapshot.val() || {};
                        let usernameExists = false;

                        for (let userId in users) {
                            if (users[userId].username.toLowerCase() === username.toLowerCase()) {
                                usernameExists = true;
                                break;
                            }
                        }

                        if (usernameExists) {
                            signupMessage.textContent = 'âŒ Username already taken!';
                            signupMessage.style.background = '#f44336';
                            signupBtn.disabled = false;
                            return;
                        }

                        signupMessage.textContent = 'â³ Creating your account...';

                        const newUserRef = database.ref('users').push();
                        const userData = {
                            id: newUserRef.key,
                            username: username,
                            avatar: avatar,
                            joinedAt: Date.now()
                        };

                        return newUserRef.set(userData)
                            .then(() => {
                                signupMessage.textContent = 'âœ… Account created! Redirecting...';
                                localStorage.setItem('chatapp_user', JSON.stringify(userData));
                                setTimeout(() => {
                                    window.location.href = 'final-chat.html';
                                }, 1000);
                            });
                    })
                    .catch(error => {
                        signupMessage.textContent = 'âŒ Error: ' + error.message;
                        signupMessage.style.background = '#f44336';
                        signupBtn.disabled = false;
                    });
            });
        });
    </script>
</body>
</html>
